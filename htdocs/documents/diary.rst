=========================
日報
=========================

:著者: yife

2012年6月11日
======================

| 課題を教えてもらった。
| まずはさくらサーバにLAMP構成をインストール。
| yife.infoのネームサーバをさくらに変更。
| suEXECに気づかなかったので大幅に時間をロス。
| smartyを導入終了 18:05
| 日報ファイルを作成 18:05
| サーバにffmpegをインストールするためにrpmforgeを追加 18:17
| ffmpegをインストール 18:17
| php-ffmpegがうまくコンパイルできないで詰まる 18:34
| php-ffmpegのmake testに失敗したままだけど、なんか動くみたい...? 19:21
| 動画のサムネイル画像を、フレーム指定して取ってくるところまで成功 19:40

2012/06/12
=================================
| ローカルにffmpegを入れて、どんなオプションをつければいいのか調査
| サーバ上でもきちんとH264+AACでエンコードできることを確認　12:41
| フロントエンドを作成開始...しようとしたら、要件定義してないことに気づいて書き出した
| データベーススキーマを構築
| mroongaを導入・動作確認 16:00
| 難しそうなところから手を着けよう...ということで、twitter oauthを理解する
| twitter oauthは外部アプリケーションのユーザ管理のためのツールではないことを理解した。
| OpenIDやはてなAPIも試してみたが、よくわからない。はてなはなぜかエラーが出る
| phpUserClassというライブラリを見つけたのでそれで行こうと考えている 16:45
| phpUserClassもひととおり読んだので、とりあえずtwitter bootstrapでindex.phpとかつくってる 18:19
| ひととおりフロントエンドもやっつけたので、ログインかどうかの判別を各ページに実装する　19:07
| とりあえずログインページから実装するよ 19:08
| なんかCSRFのことが頭から離れなくて、無意識に実装してたけど、手間がかかるからやめる 20:05
| ログインページの仕組みをつくりおわた！ たぶんログイン周りは理解したと思うよー 20:22
| アカウント登録ページ触ってる。まさかのパスワード空白OKだったのでチェック処理しないと... 21:03
| アカウント登録ページも作成完了しますた　21:46

2012/06/13
=========================================
| さて、なにをしようかな... 11:26
| アップロードページをつくろうかな。まずはログイン状態でのみアップロードフォームが出るように。 11:26
| ログイン状態かどうかで、アップロードの表示を切り替えるのに成功しました 11:55
| アップロードの実装に入りますー。どうやってやるのかわかんないな 11:55
| おひるごはん。帰ってきたらバグ取りから 13:00
| ファイルのアップロード部分しゅうりょー 14:43
| 次なにつくろうかな... 眠い 順番的にはクローラかなぁ？ 14:44
| クローラつくる 14:44
| そのまえに、アップローダで2Mを越えるファイルがアップロードできなかったのを修正。 14:53
| クローラで、キューから動画情報を取ってきて、置いてあるファイルを変換して新しいファイルを置き直すところまでは完了 15:54
| クローラがエンコード待ちキューからエンコード終わったファイルを削除するの完了したお... DELETE権限つけるの忘れてて大幅に時間ロスしたお 16:58
| クローラ完成 17:05
| ビューワつくる 17:07
| Asciiのサンプルを見てパクってるところ 19:10
| とりまコメントが流れるようになった。ただし、あたらしくコメントをjsonに追加する部分は未実装 21:01
| GETリクエストによって、JSONファイルに追記するHTTP APIを実装すればいいかな？ 21:01

2012/06/14
=================================================
| 朝からビューワページを実装してた
| コメント投稿APIつくった
| ビューワページにきちんとコメントが流れるようにした
| ビューワページでコメントを入力すると、jsonに反映されるようになった！ 15:52
| タグ追加機能完成 16:45
| 検索ページつくるかー 16:45
| まるっと検索完成 17:54
| エンコードクローラをcrontabに追加する。とりま2分に1回でいいや 17:54
| たぶん追加できたと思うんだけど... 18:00
| うまくうごいてた！ 18:04
| telop.jsがねるどらむのjsonを直接読み込んじゃってたので修正する 18:04
| 修正した！　18:34
| 各ページのトップがおかしいのを直す 18:34
| なおした
| 視聴ページで視聴回数をカウントするようにする 18:38
| 修正した 18:42
| ランキングページつくる 18:42
| ランキングページできた 19:26
| とりまレギュレーションは満たすものができたので満足しつつ寝ない 19:26
| トップページに新着動画でも出すようにするかな 19:27
| トップページに新着動画一覧を出すようにした 19:31
| クローラをキーファイル方式にして、再遅1秒でエンコードが始まるようにした。ま、どうせ1ファイルずつしかやってくれないですけどね 19:44
| ビューワで、再生ボタンを押すと、ループアイコンに変化するようにした。いままでは押せたかどうかわかりづらかったので。 19:54
| あしたはセキュリティチェックとかかなー 19:57
| えっと、とりあえずコメント投稿とタグ投稿がぱっと思いつく脆弱性
| あとアップロード時のタイトルと説明文もチェックしないと
| コメントやタグの追加API側でもチェックするべき 19:58


2012/06/15
===================================================================
| 昨日おもいついてた脆弱性はつぶした 12:02
| サムネイル画像生成やろっかな 12:03
| なんかsearchable_videosテーブルに削除できないレコードができてる & なにをいれてもunique制約とぶつかる のでいったん消してつくりなおした 12:56
| サムネイル画像をクローラで生成するようにした。2秒目の1フレーム目をとってくる
| サムネイル画像の大きさを4:3にしたいのと、トップページの新着一覧・検索結果の一覧でサムネを出したい。帰ってきたらやる？ 12:57
| サムネイルサイズを指定した（テストしてない）ところでお昼 13:01
| 動画を投稿するとindexでサムネイルが出るようにした 14:30
| ログイン状態によってログイン名が変わるようになった
| pptxファイル書いてる 16:39
| pptx書き終わった 16:56